# /etc/rancher/k3s/config.yaml

# Container Runtime Settings
snapshotter: "fuse-overlayfs"  # Uses the default k3s snapshotter (alternatives: native, overlayfs)

# API Server Performance Tuning
kube-apiserver-arg:
  - "request-timeout=10m"            # Global request timeout (default: 1m)
  - "min-request-timeout=600"        # Minimum timeout in seconds (default: 1800)
  - "http2-max-streams-per-connection=2000"  # More concurrent streams
  - "max-requests-inflight=2000"     # Increase from default 400
  - "max-mutating-requests-inflight=500" # Increase from default 200

# Controller Manager Tuning
kube-controller-manager-arg:
  - "node-monitor-period=5s"
  - "node-monitor-grace-period=20s"
  - "node-eviction-rate=0.1"               # New replacement (default 0.1)
  - "secondary-node-eviction-rate=0.01"    # New replacement (default 0.01)
  - "unhealthy-zone-threshold=0.55"        # Threshold for evictions (default 0.55)

# Kubelet Performance

# etcd Tuning (for embedded etcd)
etcd-expose-metrics: true       # Enable etcd metrics
etcd-arg:
  - "auto-compaction-retention=5m" # Same as your compaction-interval intent
  - "auto-compaction-mode=periodic"
  - "quota-backend-bytes=8589934592" # 8GB space quota (adjust as needed)

# Disable Unused Components
disable:
  - "traefik"                  # Disable if not using ingress
  - "metrics-server"           # Disable if not needed or using alternatives
